---
title: "Control Flow"
format: html
editor: visual
---

The exercises in this document follow along closely with [Lesson 7](https://swcarpentry.github.io/r-novice-gapminder/07-control-flow.html) of [R for Reproducible Scientific Analysis](https://swcarpentry.github.io/r-novice-gapminder/), provided by the [Software Carpentry](https://software-carpentry.org/) community under the creative commons license, [CC-BY 4.0](https://creativecommons.org/licenses/by/4.0/). For more information see [The Carpentries](https://carpentries.org/).

::: callout-tip
## Key Points

-   Use if and else to make choices.
-   Use for to repeat operations.
:::

```{r}
#| include: false
library(gapminder)
data(gapminder)

library(magrittr)
```

#### Challenge 1

Use an `if()` statement to print a suitable message reporting whether there are any records from 2002 in the `gapminder` dataset.

<!-- Challenge 1a answer begin -->

```{r}
if(any(gapminder$year == 2002))
  print("Found record(s) for the year 2002 in gapminder")
```

<!-- Challenge 1a answer end -->

Now do the same for 2012.

<!-- Challenge 1b answer begin -->

```{r}
if(any(gapminder$year == 2012))
  print("Found record(s) for the year 2012 in gapminder")
```

<!-- Challenge 1b answer end -->

#### Challenge 2

Given `output_vector` and `output_vector2`:

```{r}
output_vector <- c()
for (i in 1:5) {
  for (j in c('a', 'b', 'c', 'd', 'e')) {
    temp_output <- paste(i, j)
    output_vector <- c(output_vector, temp_output)
  }
}
output_matrix <- matrix(nrow = 5, ncol = 5)
j_vector <- c('a', 'b', 'c', 'd', 'e')
for (i in 1:5) {
  for (j in 1:5) {
    temp_j_value <- j_vector[j]
    temp_output <- paste(i, temp_j_value)
    output_matrix[i, j] <- temp_output
  }
}
output_vector2 <- as.vector(output_matrix)
```

Compare the objects `output_vector` and `output_vector2`. Are they the same? If not, why not? How would you change the last block of code to make `output_vector2` the same as `output_vector`?

<!-- Challenge 2 answer begin -->

The values are the same, but they are ordered differently. The is because the matrix is stored as a vector of columns, so `as.vector` returns column 1, then column 2, etc...

To make them the same, we could modify the assignment statement, `output_matrix[i, j] <- temp_output`, by swaping `i` and `j`. This would transpose the matrix and return the same order as is in `output_vector`. Alternately, we could use the transpose function, `t`, as follows:

```{r}
t(output_matrix) %>%
  as.vector()
```

<!-- Challenge 2 answer end -->

#### Challenge 3

Write a script that loops through the `gapminder` data by continent and prints out whether the mean life expectancy is smaller or larger than 50 years.

<!-- Challenge 3 answer begin -->

```{r}
thresh <- 50

for(cont in unique(as.character(gapminder$continent)))
{
  tmp <- gapminder[gapminder$continent == cont, 'lifeExp'] %>%
    unlist() %>%
    mean()
  
  if(tmp <= thresh)
  {
    cat("Average life expectancy in", cont, "is less than", thresh, "\n")
  }else{
    cat("Average life expectancy in", cont, "is greater than", thresh, "\n")
  }
}
```

<!-- Challenge 3 answer end -->

#### Challenge 4

Modify the script from Challenge 3 to loop over each country. This time print out whether the life expectancy is smaller than 50, between 50 and 70, or greater than 70.

<!-- Challenge 4 answer begin -->

```{r}
thresh <- c(50, 70)

for(ctry in unique(as.character(gapminder$country)))
{
  tmp <- gapminder[gapminder$country == ctry, 'lifeExp'] %>%
    unlist() %>%
    mean()
  
  if(tmp <= thresh[1])
  {
    cat("Average life expectancy in", ctry, "is less than", thresh[1], "\n")
  }else if(tmp <= thresh[2]){
    cat("Average life expectancy in", ctry, "is between", thresh[1], "and", thresh[2], "\n")
  }else{
    cat("Average life expectancy in", ctry, "is greater than", thresh[2], "\n")
  }
}
```

<!-- Challenge 4 answer end -->
